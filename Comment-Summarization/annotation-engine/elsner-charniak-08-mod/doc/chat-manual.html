<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.5: http://docutils.sourceforge.net/" />
<title>Chat Disentanglement</title>
<style type="text/css">

/*
:Author: David Goodger
:Contact: goodger@python.org
:Date: $Date: 2006-05-21 22:44:42 +0200 (Sun, 21 May 2006) $
:Revision: $Revision: 4564 $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin-left: 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left {
  clear: left }

img.align-right {
  clear: right }

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font-family: serif ;
  font-size: 100% }

pre.literal-block, pre.doctest-block {
  margin-left: 2em ;
  margin-right: 2em }

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document" id="chat-disentanglement">
<h1 class="title">Chat Disentanglement</h1>

<div class="contents topic">
<p class="topic-title first"><a id="contents" name="contents">Contents</a></p>
<ul class="simple">
<li><a class="reference" href="#introduction" id="id6" name="id6">Introduction</a></li>
<li><a class="reference" href="#dataset" id="id7" name="id7">Dataset</a><ul>
<li><a class="reference" href="#ethics" id="id8" name="id8">Ethics</a></li>
<li><a class="reference" href="#data-files" id="id9" name="id9">Data Files</a></li>
<li><a class="reference" href="#format" id="id10" name="id10">Format</a></li>
</ul>
</li>
<li><a class="reference" href="#preprocess-and-annotation" id="id11" name="id11">Preprocess and Annotation</a></li>
<li><a class="reference" href="#scoring-and-analysis" id="id12" name="id12">Scoring and Analysis</a></li>
<li><a class="reference" href="#training-and-testing" id="id13" name="id13">Training and Testing</a></li>
<li><a class="reference" href="#references" id="id14" name="id14">References</a></li>
</ul>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id6" id="introduction" name="introduction">Introduction</a></h1>
<p>This is the dataset and code described in <a class="citation-reference" href="#elsnercharniak08" id="id1" name="id1">[ElsnerCharniak08]</a> . It is
designed to analyze IRC chat conversations, with the aim of
disentangling multiple simultaneous conversations.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Contact:</th><td class="field-body">Micha Elsner (<a class="reference" href="mailto:melsner&#64;cs.brown.edu">melsner&#64;cs.brown.edu</a>)</td>
</tr>
</tbody>
</table>
<p>Some of the code in this package is written by other people.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Other authors:</th><td class="field-body"><p class="first">grouper.py (python cookbook)</p>
<p>AIMA utilities (support code for AI: A Modern Approach;
<a class="reference" href="http://aima.cs.berkeley.edu/python/readme.html">http://aima.cs.berkeley.edu/python/readme.html</a>)</p>
<p>waterworks utility package (David McClosky; <a class="reference" href="http://cs.brown.edu/~dmcc">http://cs.brown.edu/~dmcc</a>)</p>
<p>Probably/ClusterMetrics utilities (David McClosky; not
publically available yet)</p>
<p>pyung.py Hungarian algorithm implementation (Federico
Tomassini)</p>
</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">To make the code work, you will also need to download some programs:</th></tr>
<tr><td>&nbsp;</td><td class="field-body"><p class="first"><a class="citation-reference" href="#megam" id="id2" name="id2">[megam]</a>, a maximum-entropy classifier by Hal Daume III</p>
<p class="last">pylab plotting library, which in turn needs <a class="citation-reference" href="#matplotlib" id="id3" name="id3">[matplotlib]</a>
(needed only for analysis programs which make diagrams)</p>
</td>
</tr>
</tbody>
</table>
<p>Add the <em>utils</em> directory, which contains some general-purpose
libraries, to your PYTHONPATH environment variable.</p>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id7" id="dataset" name="dataset">Dataset</a></h1>
<p>The transcript is a recording from IRC, in late May 2007. It comes
from the ##linux channel at <a class="reference" href="http://freenode.net">http://freenode.net</a>. You can see a usage
profile of this channel at
<a class="reference" href="http://irc.netsplit.de/channels/details.php?room=%23%23linux&amp;net=freenode">http://irc.netsplit.de/channels/details.php?room=%23%23linux&amp;net=freenode</a>.</p>
<div class="section">
<h2><a class="toc-backref" href="#id8" id="ethics" name="ethics">Ethics</a></h2>
<p>The Brown IRB has determined that our study &quot;does not involve the use
of human subjects as defined by the Code of Federal Regulations&quot;,
since it is not &quot;about&quot; the individuals in the chat room (presumably
because it does not use &quot;private identifiable data&quot;).</p>
<p>However, we did feel it was appropriate to anonymize the chat as much
as possible, so we assigned each commentator an alias. These aliases
are randomly selected from a US Census name list (included as
<em>data/names</em>). Name substitution is not perfect; the system can't
detect misspelled or abbreviated names.</p>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id9" id="data-files" name="data-files">Data Files</a></h2>
<p>The dataset is contained in <em>IRC</em>. There are three annotated sections,
<em>IRC/test</em>, <em>IRC/pilot</em> and <em>IRC/dev</em>. In addition, there is the whole
dataset, <em>IRC/linux</em>, and all the unannotated data, <em>IRC/rest</em>.</p>
<p>The data is divided as follows:</p>
<blockquote>
<p>1-500: pilot (markable lines 359: 0:58:10)</p>
<p>501-1501: dev (markable lines 706: 2:6:24)</p>
<p>100 line gap, since the same annotators may mark both dev and test and we don't want them to make test decisions based on remembered dev data</p>
<p>1601-2601: test (markable lines 800: 1:39:37)</p>
<p>100 line gap</p>
<p>rest</p>
</blockquote>
<p>Currently we have four pilot annotations:</p>
<blockquote>
<p>pilot-0X (experimenter)</p>
<p>1-2 (subjects)</p>
<p>3X (subject, unfamiliar with linux OS)</p>
</blockquote>
<p>One dev annotation:</p>
<blockquote>
dev-0X (experimenter)</blockquote>
<p>7 test annotations:</p>
<blockquote>
<p>0-5 (subjects)</p>
<p>6X (subject, misunderstood instructions)</p>
</blockquote>
<p>For linux-test-5.annot, a bug in the annotation software allowed the
annotation -1 (SYS_THREAD) for real lines. The lines which were
mislabeled were replaced with sequential annotations T70 through
T85. I have listed these here (by line number).</p>
<pre class="literal-block">
6 T-1 15423 Chauncey: the human touch ?
278 T-1 17586 Felicia: her*
409 T-1 18196 Inez: call later in the afternoon, since I sleep in late~
495 T-1 18646 Lai: Alisa: heh
646 T-1 19400 Lai: thanks
657 T-1 19452 Lai: Felicia:
665 T-1 19526 Nicki: why do you say &quot;alleged&quot; non-payment? did you pay or didn't you? :)
666 T-1 19528 Felicia: Lai: PM me the address .. atleast one of us will have it
687 T-1 19693 Felicia: hehe .. figures
721 T-1 20016 Arlie: congratulations
791 T-1 20388 Madison: tampa
795 T-1 20407 Alisa: Arlie: there are some nice coal fires in China too....maybe there.
857 T-1 20627 Mellisa: awww
908 T-1 20905 Santo: yay for romance languages
909 T-1 20909 Madison: lol
911 T-1 20912 Madison: you like ?
</pre>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id10" id="format" name="format">Format</a></h2>
<p>For privacy and convenience, the chats have been edited so that each
line conforms to the following format:</p>
<pre class="literal-block">
time name (: comment)|(* action)
</pre>
<p>Times are given in seconds after the start of the transcript.</p>
<p>The name is the name of the speaker.</p>
<p>A comment is something someone &quot;says&quot;; an action is either a
system-generated message (&quot;Matilda * entered the room&quot;) or a person's
action, shown in the third-person  (&quot;Matilda * slaps Morris with a
trout&quot;).</p>
<p>Annotated lines have an additional field showing the thread:</p>
<pre class="literal-block">
T(thread) time name (: comment)|(* action)
</pre>
<p>T-1 is the &quot;system&quot; thread, reserved for system messages. We recognize
four of these:</p>
<pre class="literal-block">
entered the room
left the room
set mode
is now known as
</pre>
<p>The namechange action (&quot;foo is now known as bar&quot;) is rendered
meaningless by the aliasing system, since the old and new nicknames
are given the same alias (&quot;Matilda * is now known as Matilda&quot;).</p>
</div>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id11" id="preprocess-and-annotation" name="preprocess-and-annotation">Preprocess and Annotation</a></h1>
<p>We recorded our data using the gaim chat client. (gaim, now called
pidgin, is available from <a class="reference" href="http://www.pidgin.im/">http://www.pidgin.im/</a>) You can activate
logging from the <em>Tools/Preferences</em> menu item; click the <em>Logging</em>
tab, select &quot;Plain text&quot; logs and click &quot;Log all chats&quot;.</p>
<p>The raw data can be formatted using the <em>preprocess/stripChat.py</em>
script, which takes the name of the data file as an argument and
writes the formatted version to standard out.</p>
<p>The annotation software is written in Java. Although we are providing
the code, it's honestly pretty terrible-- editing it may be more
trouble than it's worth.</p>
<p>Running the code is easy:</p>
<pre class="literal-block">
java ChatView [filename]
</pre>
<p>The intro.txt file in the same directory contains a quick tutorial on
using the annotator, which we gave to all our experimental
subjects. Load it into the viewer and follow the instructions.</p>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id12" id="scoring-and-analysis" name="scoring-and-analysis">Scoring and Analysis</a></h1>
<p>The main routines for analysis of a single annotation are in
<em>analysis/chatStats.py</em>. You can also run this file as a program,
using an annotated file as an argument, to get a variety of
information about the annotation. It will print out some statistics
related to the annotation, then run some baselines and print
statistics about them.</p>
<p>The output looks like this:</p>
<pre class="literal-block">
Annotation:
The annotated part of this transcript has 500 lines.
Non-system lines: 359 .
36 unique threads.
The average conversation length is 9.97222222222 .
The median conversation length is 3 .
The entropy is 4.0024467585 bits.
The median chat has 1.0 interruptions per line.
The average block of 10 contains 2.94555873926 threads.
The line-averaged conversation density is  2.28969359331 .
</pre>
<p>At the bottom it prints agreement metrics between the baselines and
the annotation.</p>
<pre class="literal-block">
Evaluating all1 against human VI: 4.0024467585 MI:
-8.881784197e-16 1-1-g: 0.197771587744 1-1-o: 0.197771587744 m-1:
0.197771587744 loc-1: 0.555865921788 loc-2: 0.551820728291 loc-3:
0.544943820225
</pre>
<p>VI is variation of information <a class="citation-reference" href="#meila99" id="id4" name="id4">[Meila99]</a>. MI is mutual
information. 1-1-g is one-to-one overlap, computed by a greedy
algorithm, 1-1-o is one-to-one overlap computed optimally (with the
Hungarian algorithm). m-1 is many-to-one (not by entropy as in the
paper, just treats the human annotation as target), and the loc-N are
local error, as in the paper.</p>
<p>There are a few small scripts that get other information:
<em>describe.py</em> gets min/max/mean for some statistics over a collection
of annotations. <em>printDeltaT.py</em> prints all the time gaps (sorted) and
<em>printTimes.py</em> prints total duration of a
transcript. <em>speakerStats.py</em> prints some information on how many
conversations speakers participate in, then scatter-plots
conversations participated in versus utterances spoken.</p>
<p>It's fairly easy to write scripts like this, and the code shouldn't be
too awful.</p>
<p>The <em>distMat.py</em> script is the main tool for comparison of different
annotations. To use this tool, you must supply the <em>--metric</em> flag,
followed by &quot;121&quot;, &quot;m21&quot;, &quot;loc3&quot; or &quot;vi&quot;, as the first argument. (M21
here does determine source/target by entropy.) Then you must supply a
&quot;.annot&quot; file as the second argument. After this, you can supply any
number of &quot;.annot&quot; files, plus &quot;speaker&quot;, &quot;alldiff&quot;, &quot;all1&quot;, &quot;b[#N]&quot;
(blocks of N) or &quot;s[#N]&quot; (pause of N) for baseline annotations of the
dataset.</p>
<pre class="literal-block">
% python analysis/distMat.py --metric loc3 IRC/pilot/*.annot speaker
</pre>
<p>The output is a symmetric matrix of the metric values. min/max/average
or other statistics can be extracted with matlab or some other tool,
and you can also use it for plotting, MDS and so forth.</p>
<p>Finally, you can search for optimal values for block and pause
baselines using <em>bestBaseline.py</em>. Here you must supply <em>--metric</em>,
<em>--score</em>, which must be &quot;max&quot;, &quot;min&quot; or &quot;avg&quot;, and <em>--annotator</em>,
which must be &quot;blocks&quot; or &quot;pause&quot;, followed by a list of <em>.annot</em>
files.</p>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id13" id="training-and-testing" name="training-and-testing">Training and Testing</a></h1>
<p>To test the model, you will first need the unigram statistics and
technical word list. We have included ours (<em>data/linux-unigrams.dump</em>
and <em>data/techwords.dump</em>) so you don't have to make them. If you
would like to do so anyway, you can make the unigram stats file by
running <em>unigramStats.py</em>:</p>
<pre class="literal-block">
% python model/unigramStats.py [transcript] [output file]
</pre>
<p>You can make the techwords file by running &quot;cacheLinuxWords.py&quot;:</p>
<pre class="literal-block">
% python model/cacheLinuxWords.py [directory with linux text] [directory with Penn Treebank parses] [output file]
</pre>
<p>This program reads its non-linux text from Penn Treebank parse files,
and requires the &quot;InputTree&quot; python interface to the Charniak parser's
tree-reader, which can be obtained from cs.brown.edu/~dmcc. However,
it should be trivial to change this if you want.</p>
<p>Now you can run the test. This takes place in two stages: to do
feature extraction, train the classifier and run it, use
<em>classifierTest.py</em>:</p>
<pre class="literal-block">
% python model/classifierTest.py [training file] [test file] [unigram stats] [tech words list] [working dir]
</pre>
<p>For instance you can use:</p>
<pre class="literal-block">
% python model/classifierTest.py IRC/dev/linux-dev-0X.annot IRC/pilot/linux-pilot-0X.annot data/linux-unigrams.dump data/techwords.dump scratch
</pre>
<p>Currently you can only train or test on one annotation at a
time. (There is no automatic way to find the average classification
error over multiple annotations either-- sorry!)</p>
<p>The program will create a directory <em>scratch/129</em> (129 is the maximum
number of seconds between utterances which the classifier will try to
link.). In this directory are files <em>keys</em>, <em>feats</em>, <em>model</em> and
<em>predictions</em>. <em>keys</em> contains the indices <em>i j</em> of the two utterances
corresponding to each classification instance. For the other file
formats, see the documentation for <a class="citation-reference" href="#megam" id="id5" name="id5">[megam]</a>.</p>
<p>To evaluate the classifier, use <em>model/classifierPrecRec.py [model
dir]</em> (model dir is a directory created in the previous step, eg
<em>scratch/129</em>). This prints precision, recall and balanced F-score of
the <em>same conversation</em> class.</p>
<p>Finally, a new annotation can be created using the greedy cut
procedure described in the paper. To do this, use <em>model/greedy.py</em>:</p>
<pre class="literal-block">
% python model/greedy.py [transcript] [predictions] [keys]
</pre>
<p>The new transcript (along with some other information which you will
probably need to remove by hand) is printed to standard out. To
evaluate this transcript, see the previous section.</p>
<p>We have included the system annotation of the test set, as
<em>model/system.annot</em>. Since the algorithm is deterministic, you should
be able to reproduce this transcript using the instructions here.</p>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id14" id="references" name="references">References</a></h1>
<table class="docutils citation" frame="void" id="elsnercharniak08" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1" name="elsnercharniak08">[ElsnerCharniak08]</a></td><td>Micha Elsner and Eugene Charniak. &quot;You Talking To Me? A Corpus and Algorithm for Conversation Disentanglement&quot;. ACL '08.</td></tr>
</tbody>
</table>
<table class="docutils citation" frame="void" id="meila99" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4" name="meila99">[Meila99]</a></td><td>Marina Meila. &quot;Comparing Clusterings&quot;. UW Statistics Technical Reports, COLT '03. <a class="reference" href="http://www.stat.washington.edu/mmp/www.stat.washington.edu/mmp/Papers/compare-colt.pdf">http://www.stat.washington.edu/mmp/www.stat.washington.edu/mmp/Papers/compare-colt.pdf</a></td></tr>
</tbody>
</table>
<table class="docutils citation" frame="void" id="megam" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a name="megam">[megam]</a></td><td><em>(<a class="fn-backref" href="#id2">1</a>, <a class="fn-backref" href="#id5">2</a>)</em> Hal Daume III. Paper at <a class="reference" href="http://pub.hal3.name#daume04cfg-bfgs.pdf">http://pub.hal3.name#daume04cfg-bfgs.pdf</a>, program at <a class="reference" href="http://hal3.name/megam">http://hal3.name/megam</a></td></tr>
</tbody>
</table>
<table class="docutils citation" frame="void" id="matplotlib" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3" name="matplotlib">[matplotlib]</a></td><td><a class="reference" href="http://matplotlib.sourceforge.net/">http://matplotlib.sourceforge.net/</a></td></tr>
</tbody>
</table>
</div>
</div>
</body>
</html>
